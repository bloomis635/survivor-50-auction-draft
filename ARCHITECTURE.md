# System Architecture

Visual overview of the Survivor 50 Auction Draft application architecture.

## High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT DEVICES                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   Browser    â”‚  â”‚   Browser    â”‚  â”‚   Browser    â”‚          â”‚
â”‚  â”‚   (Host)     â”‚  â”‚  (Player 1)  â”‚  â”‚  (Player 2)  â”‚          â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚          â”‚
â”‚  â”‚  React UI    â”‚  â”‚  React UI    â”‚  â”‚  React UI    â”‚          â”‚
â”‚  â”‚  Socket.IO   â”‚  â”‚  Socket.IO   â”‚  â”‚  Socket.IO   â”‚          â”‚
â”‚  â”‚  Client      â”‚  â”‚  Client      â”‚  â”‚  Client      â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                  â”‚                  â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚                  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    WebSocket Connection
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SERVER (Node.js)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Custom Next.js Server                   â”‚  â”‚
â”‚  â”‚                       (server.ts)                          â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚  â”‚
â”‚  â”‚  â”‚  Socket.IO      â”‚         â”‚  Next.js        â”‚         â”‚  â”‚
â”‚  â”‚  â”‚  Server         â”‚         â”‚  HTTP Routes    â”‚         â”‚  â”‚
â”‚  â”‚  â”‚                 â”‚         â”‚                 â”‚         â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Events       â”‚         â”‚  â€¢ API Routes   â”‚         â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Broadcasting â”‚         â”‚  â€¢ Pages        â”‚         â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Connections  â”‚         â”‚  â€¢ Static       â”‚         â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â”‚
â”‚  â”‚           â”‚                           â”‚                   â”‚  â”‚
â”‚  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚  â”‚
â”‚  â”‚                      â”‚                                    â”‚  â”‚
â”‚  â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚  â”‚
â”‚  â”‚           â”‚   Room Manager      â”‚                        â”‚  â”‚
â”‚  â”‚           â”‚   (room-manager.ts) â”‚                        â”‚  â”‚
â”‚  â”‚           â”‚                     â”‚                        â”‚  â”‚
â”‚  â”‚           â”‚  â€¢ State Cache      â”‚                        â”‚  â”‚
â”‚  â”‚           â”‚  â€¢ Game Logic       â”‚                        â”‚  â”‚
â”‚  â”‚           â”‚  â€¢ Validation       â”‚                        â”‚  â”‚
â”‚  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚  â”‚
â”‚  â”‚                      â”‚                                    â”‚  â”‚
â”‚  â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚  â”‚
â”‚  â”‚           â”‚   Prisma ORM        â”‚                        â”‚  â”‚
â”‚  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                                     â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚              â”‚   SQLite Database   â”‚                         â”‚
â”‚              â”‚     (dev.db)        â”‚                         â”‚
â”‚              â”‚                     â”‚                         â”‚
â”‚              â”‚  â€¢ Rooms            â”‚                         â”‚
â”‚              â”‚  â€¢ Players          â”‚                         â”‚
â”‚              â”‚  â€¢ Contestants      â”‚                         â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow

### 1. Room Creation Flow

```
Browser                  Server                   Database
   â”‚                       â”‚                         â”‚
   â”‚â”€â”€â”€â”€â”€POST /api/â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                         â”‚
   â”‚   rooms/create         â”‚                         â”‚
   â”‚                        â”‚â”€â”€â”€â”€â”€â”€INSERT Roomâ”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
   â”‚                        â”‚                         â”‚
   â”‚                        â”‚â—€â”€â”€â”€â”€Room Createdâ”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚â—€â”€â”€â”€â”€{roomId, key}â”€â”€â”€â”€â”€â”‚                         â”‚
   â”‚                        â”‚                         â”‚
   â”‚â”€â”€localStorage.set()â”€â”€â”‚                         â”‚
   â”‚                        â”‚                         â”‚
   â”‚â”€â”€â”€â”€â”€Navigate toâ”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                         â”‚
   â”‚   /room/[roomId]       â”‚                         â”‚
```

### 2. Join Room Flow

```
Browser                Socket.IO               Room Manager          Database
   â”‚                       â”‚                         â”‚                    â”‚
   â”‚â”€â”€â”€WebSocket Connectâ”€â”€â”€â–¶â”‚                         â”‚                    â”‚
   â”‚                        â”‚                         â”‚                    â”‚
   â”‚â”€â”€{room:join}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                         â”‚                    â”‚
   â”‚   playerName           â”‚                         â”‚                    â”‚
   â”‚                        â”‚                         â”‚                    â”‚
   â”‚                        â”‚â”€â”€â”€loadRoom(roomId)â”€â”€â”€â”€â”€â–¶â”‚                    â”‚
   â”‚                        â”‚                         â”‚â”€â”€SELECT * FROMâ”€â”€â”€â–¶â”‚
   â”‚                        â”‚                         â”‚                    â”‚
   â”‚                        â”‚                         â”‚â—€â”€â”€â”€Room Dataâ”€â”€â”€â”€â”€â”€â”‚
   â”‚                        â”‚â—€â”€â”€â”€RoomStateâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚
   â”‚                        â”‚                         â”‚                    â”‚
   â”‚                        â”‚â”€â”€addPlayer()â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                    â”‚
   â”‚                        â”‚                         â”‚â”€â”€INSERT Playerâ”€â”€â”€â–¶â”‚
   â”‚                        â”‚â—€â”€â”€â”€Updated Stateâ”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚
   â”‚                        â”‚                         â”‚                    â”‚
   â”‚â—€â”€â”€{room:state}â”€â”€â”€â”€â”€â”€â”€â”€â”‚                         â”‚                    â”‚
   â”‚   (full state)         â”‚                         â”‚                    â”‚
   â”‚                        â”‚                         â”‚                    â”‚
   â”‚                        â”‚â”€â”€broadcastâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                    â”‚
   â”‚                        â”‚  to all in room         â”‚                    â”‚
```

### 3. Auction Flow

```
Host                  Server                Timer Thread         Other Players
   â”‚                     â”‚                         â”‚                    â”‚
   â”‚â”€â”€{auction:nominate}â”€â–¶â”‚                         â”‚                    â”‚
   â”‚   contestantId       â”‚                         â”‚                    â”‚
   â”‚                      â”‚â”€â”€Update Stateâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚
   â”‚                      â”‚  (NOMINATED)            â”‚                    â”‚
   â”‚                      â”‚                         â”‚                    â”‚
   â”‚â—€â”€â”€{room:state}â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€{room:state}â”€â”€â”€â”€â–¶â”‚
   â”‚                      â”‚                         â”‚                    â”‚
   â”‚â”€â”€{auction:start}â”€â”€â”€â”€â–¶â”‚                         â”‚                    â”‚
   â”‚                      â”‚â”€â”€startTimer()â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                    â”‚
   â”‚                      â”‚  (30 seconds)           â”‚                    â”‚
   â”‚                      â”‚                         â”‚                    â”‚
   â”‚â—€â”€â”€{room:state}â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€{room:state}â”€â”€â”€â”€â–¶â”‚
   â”‚   (status: RUNNING)  â”‚                         â”‚                    â”‚
   â”‚                      â”‚                         â”‚                    â”‚
   â”‚                      â”‚                      [Tick]                  â”‚
   â”‚â—€â”€â”€{auction:tick}â”€â”€â”€â”€â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€{auction:tick}â”€â”€â”€â–¶â”‚
   â”‚   29s remaining      â”‚                         â”‚   29s              â”‚
   â”‚                      â”‚                         â”‚                    â”‚
   â”‚                      â”‚â—€â”€â”€{auction:bid}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚                      â”‚   amount: 5             â”‚                    â”‚
   â”‚                      â”‚â”€â”€Validate Bidâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚
   â”‚                      â”‚  (check budget, min)    â”‚                    â”‚
   â”‚â—€â”€â”€{room:state}â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€{room:state}â”€â”€â”€â”€â–¶â”‚
   â”‚   (bid accepted)     â”‚                         â”‚                    â”‚
   â”‚                      â”‚                         â”‚                    â”‚
   â”‚                      â”‚                      [Tick]                  â”‚
   â”‚â—€â”€â”€{auction:tick}â”€â”€â”€â”€â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€{auction:tick}â”€â”€â”€â–¶â”‚
   â”‚   28s                â”‚                         â”‚                    â”‚
   â”‚                      â”‚                         â”‚                    â”‚
   â”‚                      â”‚                      [...continues...]       â”‚
   â”‚                      â”‚                         â”‚                    â”‚
   â”‚                      â”‚                      [Tick]                  â”‚
   â”‚â—€â”€â”€{auction:tick}â”€â”€â”€â”€â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€{auction:tick}â”€â”€â”€â–¶â”‚
   â”‚   0s                 â”‚                         â”‚                    â”‚
   â”‚                      â”‚                         â”‚                    â”‚
   â”‚                      â”‚                    [Timer Expires]           â”‚
   â”‚                      â”‚â”€â”€endAuction()â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                    â”‚
   â”‚                      â”‚  â€¢ Assign winner        â”‚                    â”‚
   â”‚                      â”‚  â€¢ Deduct budget        â”‚                    â”‚
   â”‚                      â”‚  â€¢ Update roster        â”‚                    â”‚
   â”‚                      â”‚                         â”‚                    â”‚
   â”‚â—€â”€â”€{room:state}â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€{room:state}â”€â”€â”€â”€â–¶â”‚
   â”‚   (contestant        â”‚                         â”‚                    â”‚
   â”‚    drafted)          â”‚                         â”‚                    â”‚
```

## Component Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Frontend (React)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  app/                                                        â”‚
â”‚  â”œâ”€â”€ page.tsx â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚   â€¢ Home Page                    â”‚                       â”‚
â”‚  â”‚   â€¢ Create/Join Room             â”‚                       â”‚
â”‚  â”‚                                   â”‚                       â”‚
â”‚  â””â”€â”€ room/[roomId]/page.tsx â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚      â€¢ Socket.IO Connection         â”‚          â”‚            â”‚
â”‚      â€¢ State Management             â”‚          â”‚            â”‚
â”‚      â€¢ Phase Routing                â”‚          â”‚            â”‚
â”‚                                      â”‚          â”‚            â”‚
â”‚  components/                         â”‚          â”‚            â”‚
â”‚  â”œâ”€â”€ Lobby.tsx â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚            â”‚
â”‚  â”‚   â€¢ Player List                              â”‚            â”‚
â”‚  â”‚   â€¢ Contestant Management                    â”‚            â”‚
â”‚  â”‚   â€¢ Settings Configuration                   â”‚            â”‚
â”‚  â”‚   â€¢ Start Draft Button                       â”‚            â”‚
â”‚  â”‚                                               â”‚            â”‚
â”‚  â”œâ”€â”€ Auction.tsx â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚  â”‚   â€¢ Contestant Nomination (Host)                          â”‚
â”‚  â”‚   â€¢ Timer Display                                         â”‚
â”‚  â”‚   â€¢ Bid Buttons                                           â”‚
â”‚  â”‚   â€¢ Current Bid Display                                   â”‚
â”‚  â”‚   â€¢ Player Budgets                                        â”‚
â”‚  â”‚   â€¢ Roster Lists                                          â”‚
â”‚  â”‚                                                           â”‚
â”‚  â””â”€â”€ Results.tsx                                             â”‚
â”‚      â€¢ Final Rosters                                         â”‚
â”‚      â€¢ Spending Summary                                      â”‚
â”‚      â€¢ Export Button                                         â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Backend (Node.js)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  server.ts                                                    â”‚
â”‚  â”œâ”€â”€ HTTP Server (Next.js)                                   â”‚
â”‚  â””â”€â”€ Socket.IO Server                                        â”‚
â”‚      â”œâ”€â”€ Connection Handler                                  â”‚
â”‚      â””â”€â”€ Event Router                                        â”‚
â”‚                                                               â”‚
â”‚  lib/socket-handler.ts                                       â”‚
â”‚  â”œâ”€â”€ room:join                                               â”‚
â”‚  â”œâ”€â”€ contestant:add/edit/delete                              â”‚
â”‚  â”œâ”€â”€ settings:update                                         â”‚
â”‚  â”œâ”€â”€ draft:start                                             â”‚
â”‚  â”œâ”€â”€ auction:nominate                                        â”‚
â”‚  â”œâ”€â”€ auction:start                                           â”‚
â”‚  â”œâ”€â”€ auction:bid â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚  â””â”€â”€ disconnect        â”‚                                     â”‚
â”‚                        â”‚                                     â”‚
â”‚  lib/room-manager.ts â—€â”€â”˜                                     â”‚
â”‚  â”œâ”€â”€ loadRoom()        â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”œâ”€â”€ saveRoom()                â”‚                            â”‚
â”‚  â”œâ”€â”€ createRoom()              â”‚                            â”‚
â”‚  â”œâ”€â”€ addPlayer()               â”‚                            â”‚
â”‚  â””â”€â”€ verifyAdminKey()          â”‚                            â”‚
â”‚                                â”‚                            â”‚
â”‚  lib/prisma.ts â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚  â””â”€â”€ Prisma Client Singleton                                â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Database (SQLite)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Room                                                         â”‚
â”‚  â”œâ”€â”€ id (PK)                                                 â”‚
â”‚  â”œâ”€â”€ hostAdminKey                                            â”‚
â”‚  â”œâ”€â”€ phase                                                   â”‚
â”‚  â”œâ”€â”€ startingBudget                                          â”‚
â”‚  â”œâ”€â”€ minIncrement                                            â”‚
â”‚  â”œâ”€â”€ timerSeconds                                            â”‚
â”‚  â”œâ”€â”€ currentContestantId                                     â”‚
â”‚  â”œâ”€â”€ auctionStatus                                           â”‚
â”‚  â”œâ”€â”€ currentBid                                              â”‚
â”‚  â”œâ”€â”€ currentBidderPlayerId                                   â”‚
â”‚  â””â”€â”€ auctionEndTime                                          â”‚
â”‚                                                               â”‚
â”‚  Player                                                       â”‚
â”‚  â”œâ”€â”€ id (PK)                                                 â”‚
â”‚  â”œâ”€â”€ roomId (FK â†’ Room)                                      â”‚
â”‚  â”œâ”€â”€ name                                                    â”‚
â”‚  â”œâ”€â”€ budgetRemaining                                         â”‚
â”‚  â””â”€â”€ connected                                               â”‚
â”‚                                                               â”‚
â”‚  Contestant                                                   â”‚
â”‚  â”œâ”€â”€ id (PK)                                                 â”‚
â”‚  â”œâ”€â”€ roomId (FK â†’ Room)                                      â”‚
â”‚  â”œâ”€â”€ name                                                    â”‚
â”‚  â”œâ”€â”€ bio                                                     â”‚
â”‚  â”œâ”€â”€ imageUrl                                                â”‚
â”‚  â”œâ”€â”€ status                                                  â”‚
â”‚  â”œâ”€â”€ draftedByPlayerId (FK â†’ Player)                        â”‚
â”‚  â”œâ”€â”€ draftedPrice                                            â”‚
â”‚  â””â”€â”€ draftOrder                                              â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## State Management

### Server-Side State Cache

```
roomCache: Map<roomId, RoomState>
â”œâ”€â”€ Purpose: Fast access to room state
â”œâ”€â”€ Lifetime: Server process lifetime
â”œâ”€â”€ Invalidation: On saveRoom() call
â””â”€â”€ Recovery: Load from database on miss

RoomState:
â”œâ”€â”€ id: string
â”œâ”€â”€ phase: LOBBY | AUCTION | COMPLETE
â”œâ”€â”€ settings: { budget, increment, timer }
â”œâ”€â”€ players: Map<playerId, Player>
â”œâ”€â”€ contestants: Map<contestantId, Contestant>
â””â”€â”€ currentAuction: {
    contestantId,
    status,
    currentBid,
    currentBidderPlayerId,
    endTime
}
```

### Client-Side State

```
localStorage:
â”œâ”€â”€ host_<roomId> â†’ adminKey (32-char secret)
â””â”€â”€ player_<roomId> â†’ playerId (for reconnection)

React State:
â”œâ”€â”€ state: RoomState | null (from server)
â”œâ”€â”€ playerId: string | null (local identity)
â”œâ”€â”€ playerName: string (display name)
â”œâ”€â”€ joined: boolean (connection status)
â”œâ”€â”€ timeRemaining: number | null (from timer ticks)
â””â”€â”€ error: string | null (validation errors)
```

## Security Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Security Layers                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. Host Authorization                                      â”‚
â”‚     â€¢ Admin key generated at room creation                  â”‚
â”‚     â€¢ 32-character cryptographically random string          â”‚
â”‚     â€¢ Stored in localStorage (never sent to other clients)  â”‚
â”‚     â€¢ Validated server-side for all admin actions           â”‚
â”‚                                                             â”‚
â”‚  2. Room Isolation                                          â”‚
â”‚     â€¢ Room code = 6-char alphanumeric (36^6 combinations)   â”‚
â”‚     â€¢ Socket.IO rooms prevent cross-room leaks              â”‚
â”‚     â€¢ Each client only receives their room's data           â”‚
â”‚                                                             â”‚
â”‚  3. Server-Authoritative Logic                              â”‚
â”‚     â€¢ All validation happens on server                      â”‚
â”‚     â€¢ Clients cannot manipulate game state                  â”‚
â”‚     â€¢ Timestamps prevent late/early bids                    â”‚
â”‚     â€¢ Budget checks server-side                             â”‚
â”‚                                                             â”‚
â”‚  4. Player Identity                                         â”‚
â”‚     â€¢ Player ID generated server-side                       â”‚
â”‚     â€¢ Stored in localStorage for reconnection               â”‚
â”‚     â€¢ Cannot impersonate other players                      â”‚
â”‚     â€¢ Connection status tracked per socket                  â”‚
â”‚                                                             â”‚
â”‚  5. Data Validation                                         â”‚
â”‚     â€¢ Bid amount: >= currentBid + minIncrement              â”‚
â”‚     â€¢ Bid amount: <= player.budgetRemaining                 â”‚
â”‚     â€¢ Auction status: must be RUNNING                       â”‚
â”‚     â€¢ Contestant status: must be AVAILABLE to nominate      â”‚
â”‚     â€¢ Timer: must not be expired                            â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Scalability Considerations

### Current Architecture (SQLite)
- **Best for**: 1-50 concurrent players
- **Limitations**: Single server, no horizontal scaling
- **Performance**: Excellent for MVP use case

### Scaling Path
```
Phase 1: SQLite + Single Server (Current)
   â†“
Phase 2: PostgreSQL + Single Server
   â€¢ Switch datasource in Prisma
   â€¢ Support 100+ concurrent players
   â†“
Phase 3: PostgreSQL + Redis + Load Balancer
   â€¢ Redis for session state
   â€¢ Multiple server instances
   â€¢ Sticky sessions or shared state
   â†“
Phase 4: Microservices (If Needed)
   â€¢ Room service
   â€¢ Auction service
   â€¢ Player service
   â€¢ WebSocket gateway
```

## Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Production                          â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         Railway / Render / Fly.io                â”‚  â”‚
â”‚  â”‚                                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚         Node.js Server                     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  (Next.js + Socket.IO)                     â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                   â”‚                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚         Persistent Volume                  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  /app/prisma/dev.db                        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  (SQLite Database)                         â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â”‚  HTTPS: Automatic (platform-provided)                  â”‚
â”‚  WebSocket: Supported natively                         â”‚
â”‚  Port: 3000 (configurable)                             â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Technology Decisions

| Decision | Rationale |
|----------|-----------|
| **Next.js** | Modern React framework, excellent DX, built-in routing |
| **Socket.IO** | Mature WebSocket library, auto-reconnection, broad browser support |
| **SQLite** | Zero-config, perfect for MVP, fast for single-server, persistent |
| **Prisma** | Type-safe ORM, great migrations, easy to switch DB later |
| **TypeScript** | Type safety prevents bugs, better IDE support, self-documenting |
| **Tailwind** | Fast styling, responsive by default, small bundle size |
| **Custom Server** | Required for Socket.IO integration with Next.js |

---

**This architecture supports:**
- âœ… Real-time multiplayer auction
- âœ… Server-authoritative game logic
- âœ… State persistence across refreshes
- âœ… Reconnection without data loss
- âœ… Race condition protection
- âœ… Easy deployment to cloud platforms
- âœ… Path to scale if needed

**Built for:**
- ğŸ¯ MVP launch
- ğŸš€ Quick iteration
- ğŸ“ˆ Future scalability
- ğŸ”’ Security from day one
